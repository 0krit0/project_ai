# AutoScope AI

ระบบเว็บสำหรับประเมินความเสียหายรถยนต์จากภาพด้วย AI รองรับการใช้งานจริงทั้งฝั่งผู้ใช้ทั่วไป ผู้ตรวจทาน และผู้ดูแลระบบ

## ความสามารถหลัก

- วิเคราะห์ความเสียหายจากภาพได้ทั้งภาพเดียวและหลายภาพ
- แสดงผลลัพธ์หลายความเป็นไปได้ (Top-K) พร้อมช่วงค่าใช้จ่ายโดยประมาณ
- จัดการเคสงานและรูปภาพในแต่ละเคส
- บันทึกประวัติการวิเคราะห์ และส่งออกรายงานเป็น CSV/PDF
- ระบบผู้ใช้ครบวงจร: สมัครสมาชิก เข้าสู่ระบบ โปรไฟล์ และรูปโปรไฟล์
- หน้าจอสำหรับผู้ตรวจทาน/ผู้ดูแลระบบ และ API สำหรับมอนิเตอร์ระบบ
- รองรับคิวงานทั้งแบบภายในเครื่อง (local) และ Redis (ทางเลือก)

## เทคโนโลยีที่ใช้

- Python 3.10+
- Flask
- TensorFlow (CPU)
- SQLite
- Waitress

## โครงสร้างไฟล์สำคัญ

- `app.py` - แอปพลิเคชัน Flask หลัก
- `db.py` - ส่วนจัดการฐานข้อมูลและการย้ายโครงสร้างข้อมูล
- `serve.py` - จุดเริ่มต้นสำหรับรันเซิร์ฟเวอร์ด้วย Waitress
- `worker.py` - เวิร์กเกอร์สำหรับงานคิว (กรณีใช้งานแบบแยกโปรเซส)
- `templates/` - เทมเพลตหน้าเว็บ
- `static/` - ไฟล์สไตล์และทรัพยากรหน้าเว็บ
- `tests/` - ชุดทดสอบระบบ

## วิธีเริ่มต้นใช้งาน (Local)

1. ติดตั้งแพ็กเกจที่จำเป็น

```bash
pip install -r requirements.txt
```

2. สร้างไฟล์ค่าตั้งต้นของสภาพแวดล้อม

```bash
copy .env.example .env
```

3. กำหนดค่าอย่างน้อยในไฟล์ `.env`

- `FLASK_SECRET_KEY`
- `APP_LOGIN_PASSWORD` (หรือใช้งานผ่านหน้าสมัครสมาชิก)
- `MODEL_VERSION=damage_model.h5`

4. รันระบบ

```bash
python serve.py
```

ระบบจะเปิดที่ `http://127.0.0.1:5000` (หรือพอร์ตที่กำหนดผ่าน `PORT`/`FLASK_PORT`)

## การทดสอบ

```bash
python -m unittest tests.test_integration_flow -v
```

## API หลัก

- `GET /api/health`
- `POST /api/analyze`
- `GET /api/analyze/jobs/<job_id>`
- `GET /api/history`
- `GET|POST /api/cases`
- `GET /api/admin/metrics`

## การนำขึ้นใช้งานจริง (Deploy)

ไฟล์ที่เตรียมไว้แล้ว:

- `Dockerfile`
- `docker-compose.yml`
- `render.yaml`
- คู่มือเพิ่มเติม: `DEPLOY_RENDER.md`

## หมายเหตุ

- โมเดลเริ่มต้นคือ `damage_model.h5`
- หากต้องการใช้คิวแบบ Redis ให้ตั้งค่า `QUEUE_BACKEND=redis` และ `REDIS_URL`
- ในระบบ production ควรแยกที่เก็บไฟล์ runtime เช่น logs และฐานข้อมูลออกจากโค้ด
